<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Comparativo - Implantações GenAI</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    /* Botão Voltar */
    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      color: #ffffff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    .back-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #7B68EE, #0033A0);
    }

    header { position: relative; }

    :root{
      /* Cores de Fundo */
      --background: #0c0e14;
      --card-bg: #1e2130;
      --card-bg-hover: #272936;
      --card-bg-secondary: #151823;

      /* Cores de Texto */
      --text: #ffffff;
      --muted: #a3a8c3;

      /* Cores de Destaque */
      --red-bradesco: #cc0000;
      --blue-bradesco: #0033A0;
      --purple-highlight: #7B68EE;
      --cyan-highlight: #00e5ff;

      /* Cores do gráfico Com x Sem interação */
      --ok: #22c55e;  /* COM interação */
      --att: #f59e0b; /* SEM interação */

      /* Cores dos CARDS (e do gráfico de média) */
      --piloto: var(--cyan-highlight); /* Piloto (azul-claro) */
      --wave1: var(--purple-highlight);  /* Wave 1 (roxo) */
      --wave2: var(--red-bradesco);      /* Wave 2 (vermelho) */
      --wave3: #ffa500;                  /* Wave 3 (laranja) */
      --wave4: #1dd1a1;                  /* Wave 4 (verde água) */

      /* Sombras */
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.4);
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    body {
      background: var(--background);
      color: var(--text);
      padding: 18px;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(0, 51, 160, 0.15) 0%, rgba(0, 51, 160, 0) 70%),
        radial-gradient(circle at 90% 80%, rgba(204, 0, 0, 0.15) 0%, rgba(204, 0, 0, 0) 70%);
    }

    .container { max-width: 1280px; margin: 0 auto; }

    header {
      display: flex;
      justify-content: center;
      margin-bottom: 18px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
    }

    header h1 {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
      text-align: center;
      background: linear-gradient(135deg, #0033A0, #7B68EE, #cc0000);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    header p { color: var(--muted); text-align: center; }

    /* KPIs */
    .kpis {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin: 18px 0;
    }

    .kpi {
      position: relative;
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 14px 14px 12px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, .06);
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      overflow: hidden;
      --accent: #6b7280;
    }

    .kpi:hover {
      transform: translateY(-2px);
      background: var(--card-bg-hover);
      border-color: rgba(255, 255, 255, .12);
      box-shadow: var(--shadow-hover);
    }

    .kpi-head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .chip { width: 32px; height: 32px; border-radius: 999px; display: inline-flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, .06); box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .08); color: var(--accent); }
    .kpi h4 { font-size: 11px; letter-spacing: .3px; color: var(--muted); font-weight: 800; text-transform: uppercase; }
    .kpi .v { font-size: 26px; font-weight: 900; line-height: 1; margin: 4px 0 6px; }
    .kpi small { color: var(--muted); font-size: 12px; }
    .kpi strong { font-weight: 900; color: #fff; }

    .kpi--total { --accent: var(--blue-bradesco); }
    .kpi--ativos { --accent: #22c55e; }
    .kpi--sem { --accent: var(--red-bradesco); }
    .kpi--inter { --accent: var(--cyan-highlight); }
    .kpi--proj { --accent: var(--blue-bradesco); }
    .kpi--adocao { --accent: #22c55e; }

    /* Cabeçalhos das ondas */
    .implantation-headers {
      display: flex;
      gap: 10px;
      margin: 10px 0 12px;
      flex-wrap: wrap;
    }

    .implantation-header {
      flex: 1;
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 10px 12px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, .06);
      transition: all 0.3s ease;
      min-width: 170px;
    }

    .implantation-header:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      background: var(--card-bg-hover);
    }

    .implantation-header h2 { font-size: 16px; margin-bottom: 4px; }
    .implantation-header p { font-size: 12px; color: var(--muted); margin: 0; }

    /* 5 colunas: Piloto | Wave 1 | Wave 2 | Wave 3 | Wave 4 */
    .grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .grid-col { display: flex; flex-direction: column; gap: 10px; min-width: 0; }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, .06);
    }

    .card:hover {
      transform: translateY(-2px);
      background: var(--card-bg-hover);
      border-color: rgba(255, 255, 255, .12);
      box-shadow: var(--shadow-hover);
    }

    .icon { font-size: 18px; margin-bottom: 8px; }
    .val { font-size: 22px; font-weight: 800; margin-bottom: 2px; }
    .lbl { font-size: 12px; color: var(--muted); }
    .sub { font-size: 11px; color: var(--muted); margin-top: 5px; }

    .tag { font-size: 11px; border-radius: 10px; padding: 2px 8px; display: inline-block; margin-top: 4px; font-weight: 700; }
    .tag.piloto { background: rgba(0, 229, 255, .18); color: var(--piloto); }
    .tag.wave1  { background: rgba(123, 104, 238, .18); color: var(--wave1); }
    .tag.wave2  { background: rgba(204,  0,   0, .18); color: var(--wave2); }
    .tag.wave3  { background: rgba(255, 165,   0, .18); color: var(--wave3); }
    .tag.wave4  { background: rgba( 29, 209, 161, .18); color: var(--wave4); }

    /* Gráficos (cards) */
    .chart-wrap {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-top: 8px;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, .06);
    }

    .chart-wrap:hover { box-shadow: var(--shadow-hover); border-color: rgba(255, 255, 255, .12); }

    .chart-title {
      font-weight: 800;
      margin-bottom: 6px;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    .chart-subtitle { font-size: 13px; color: var(--muted); margin-bottom: 10px; }
    .chart-subtitle .n { color: #fff; font-weight: 800; }
    
    /* Ajuste para o gráfico de projetos */
    .canvas-box { 
      height: 500px; 
      width: 100%; 
      overflow-x: auto;
    }
    
    .projects-chart-container {
      height: 800px; /* Aumentado para acomodar todos os projetos */
      width: 100%;
      overflow-x: auto;
      overflow-y: auto;
    }

    /* Responsivo */
    @media (max-width: 1100px) {
      .kpis { grid-template-columns: repeat(3, 1fr); }
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 720px) {
      .kpis { grid-template-columns: repeat(2, 1fr); }
      .canvas-box { height: 540px; }
      .projects-chart-container { height: 900px; }
    }
    @media (max-width: 480px) {
      .kpis { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
      .canvas-box { height: 560px; }
      .projects-chart-container { height: 1000px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div><h1>Adoção GEN AI Bradesco</h1></div>
    </header>

    <!-- Botão Voltar -->
    <a href="https://marianacintra81.github.io/Bradesco-GEN-AI/Menu%20Copilot%20e%20PromptX.html" class="back-button" aria-label="Voltar para a página anterior">
      <i class="fas fa-arrow-left" aria-hidden="true"></i>
    </a>

    <!-- KPIs (corrigidos: médias por TOTAL de usuários) -->
    <section class="kpis">
      <div class="kpi kpi--total">
        <div class="kpi-head"><div class="chip"><i class="fas fa-users"></i></div><h4>Total de Profissionais</h4></div>
        <div class="v" id="k_total">258</div>
        <small>Treinados</small>
      </div>

      <div class="kpi kpi--ativos">
        <div class="kpi-head"><div class="chip"><i class="fas fa-user-check"></i></div><h4>Usuários ativos</h4></div>
        <div class="v" id="k_ativos">238</div>
        <small><strong id="k_adocao">92,2%</strong> de adoção</small>
      </div>

      <div class="kpi kpi--sem">
        <div class="kpi-head"><div class="chip"><i class="fas fa-user-clock"></i></div><h4>Usuários sem interação</h4></div>
        <div class="v" id="k_sem">20</div>
        <small><strong id="k_sem_pct">7,8%</strong> do total</small>
      </div>

      <div class="kpi kpi--inter">
        <div class="kpi-head"><div class="chip"><i class="fas fa-bolt"></i></div><h4>Total de Interações</h4></div>
        <div class="v" id="k_inter">8016</div>
        <!-- Corrigido: média por TODOS os usuários -->
        <small id="k_media_global">Média: 31,1 por usuário</small>
           </div>

      <div class="kpi kpi--proj">
        <div class="kpi-head"><div class="chip"><i class="fas fa-diagram-project"></i></div><h4>Projetos envolvidos</h4></div>
        <div class="v" id="k_proj_total">39</div>
        <small>Somatório de projetos mapeados</small>
      </div>

     <div class="kpi kpi--adocao">
        <div class="kpi-head"><div class="chip"><i class="fas fa-gauge-high"></i></div><h4>Taxa de Adoção (geral)</h4></div>
        <div class="v" id="k_taxa_v">92,2%</div>
        <small id="k_taxa_desc">238 de 258 usuários ativos</small>
      </div>
    </section>

    <!-- Cabeçalhos – incluindo Wave 4 -->
    <div class="implantation-headers">
      <div class="implantation-header" style="border-top:4px solid var(--piloto);">
        <h2 style="color:var(--piloto)">Piloto</h2>
      </div>
      <div class="implantation-header" style="border-top:4px solid var(--wave1);">
        <h2 style="color:var(--wave1)">Wave 1</h2>
      </div>
      <div class="implantation-header" style="border-top:4px solid var(--wave2);">
        <h2 style="color:var(--wave2)">Wave 2</h2>
      </div>
      <div class="implantation-header" style="border-top:4px solid var(--wave3);">
        <h2 style="color:var(--wave3)">Wave 3</h2>
      </div>
      <div class="implantation-header" style="border-top:4px solid var(--wave4);">
        <h2 style="color:var(--wave4)">Wave 4</h2>
      </div>
    </div>

    <!-- 10 CARDS: 2 por wave (média corrigida = interações / total de usuários da wave) -->
    <section class="grid">
      <!-- Piloto -->
      <div class="grid-col">
        <div class="card">
          <div class="icon"><i class="fas fa-chart-pie" style="color:var(--piloto)"></i></div>
          <div class="val">97,8%</div><div class="lbl">Taxa de Adoção</div>
          <div class="sub"><span class="tag piloto">44 de 45 ativos</span></div>
        </div>
        <div class="card">
          <div class="icon"><i class="fas fa-sync-alt" style="color:var(--piloto)"></i></div>
          <div class="val" id="v_inter_piloto">3131</div><div class="lbl">Interações</div>
          <div class="sub"><strong>Média por total de usuários:</strong> <span id="avg_piloto">69,6</span></div>
        </div>
      </div>

      <!-- Wave 1 -->
      <div class="grid-col">
        <div class="card">
          <div class="icon"><i class="fas fa-chart-pie" style="color:var(--wave1)"></i></div>
          <div class="val">91,3%</div><div class="lbl">Taxa de Adoção</div>
          <div class="sub"><span class="tag wave1">21 de 23 ativos</span></div>
        </div>
        <div class="card">
          <div class="icon"><i class="fas fa-sync-alt" style="color:var(--wave1)"></i></div>
          <div class="val" id="v_inter_w1">705</div><div class="lbl">Interações</div>
          <div class="sub"><strong>Média por total de usuários:</strong> <span id="avg_w1">30,7</span></div>
        </div>
      </div>

      <!-- Wave 2 -->
      <div class="grid-col">
        <div class="card">
          <div class="icon"><i class="fas fa-chart-pie" style="color:var(--wave2)"></i></div>
          <div class="val">97,3%</div><div class="lbl">Taxa de Adoção</div>
          <div class="sub"><span class="tag wave2">72 de 74 ativos</span></div>
        </div>
        <div class="card">
          <div class="icon"><i class="fas fa-sync-alt" style="color:var(--wave2)"></i></div>
          <div class="val" id="v_inter_w2">2759</div><div class="lbl">Interações</div>
          <div class="sub"><strong>Média por total de usuários:</strong> <span id="avg_w2">37,3</span></div>
        </div>
      </div>

      <!-- Wave 3 -->
      <div class="grid-col">
        <div class="card">
          <div class="icon"><i class="fas fa-chart-pie" style="color:var(--wave3)"></i></div>
          <div class="val">87,5%</div><div class="lbl">Taxa de Adoção</div>
          <div class="sub"><span class="tag wave3">98 de 112 ativos</span></div>
        </div>
        <div class="card">
          <div class="icon"><i class="fas fa-sync-alt" style="color:var(--wave3)"></i></div>
          <div class="val" id="v_inter_w3">1399</div><div class="lbl">Interações</div>
          <div class="sub"><strong>Média por total de usuários:</strong> <span id="avg_w3">12,5</span></div>
        </div>
      </div>

      <!-- Wave 4 -->
      <div class="grid-col">
        <div class="card">
          <div class="icon"><i class="fas fa-chart-pie" style="color:var(--wave4)"></i></div>
          <div class="val">75,0%</div><div class="lbl">Taxa de Adoção</div>
          <div class="sub"><span class="tag wave4">3 de 4 ativos</span></div>
        </div>
        <div class="card">
          <div class="icon"><i class="fas fa-sync-alt" style="color:var(--wave4)"></i></div>
          <div class="val" id="v_inter_w4">22</div><div class="lbl">Interações</div>
          <div class="sub"><strong>Média por total de usuários:</strong> <span id="avg_w4">5,5</span></div>
        </div>
      </div>
    </section>

    <!-- CARD 1: Média de interações por projeto -->
    <section class="chart-wrap">
      <div class="chart-title">Média de Interações por Projeto</div>
      <div class="canvas-box"><canvas id="avgByProject"></canvas></div>
    </section>

    <!-- CARD 2: Projetos – Com x Sem interação -->
    <section class="chart-wrap">
      <div class="chart-title">Projetos – Com interação x Sem interação</div>
      <div class="chart-subtitle">
        <span class="n" id="projetos_sem_interacao">—</span> de <span class="n" id="total_projetos">—</span> projetos possuem usuários sem interação
      </div>
      <!-- Alterado para usar o container específico para projetos -->
      <div class="projects-chart-container"><canvas id="projectsInteractionStacked"></canvas></div>
    </section>

    <!-- CARD 3: Profissionais por Caso de Uso -->
    <section class="chart-wrap">
      <div class="chart-title">Profissionais por Caso de Uso</div>
      <div class="chart-subtitle">
        Distribuição dos <span class="n">258</span> profissionais por caso de uso
      </div>
      <div class="canvas-box"><canvas id="professionalsByUseCase"></canvas></div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      Chart.register(ChartDataLabels);
      Chart.defaults.color = '#ffffff';
      Chart.defaults.font.family = 'Inter, sans-serif';

      /* ======= DADOS ATUALIZADOS ======= */
      // Média por usuário ATIVO (será ajustada no gráfico para média por total de usuários)
      const RAW_WAVE = [
        {"proj":"Open Finance","media":147.4,"wave":"Piloto"},
        {"proj":"Investimentos","media":135.0,"wave":"Piloto"},
        {"proj":"PIX-CPF","media":77.0,"wave":"Wave 2"},
        {"proj":"ATACADO","media":72.0,"wave":"Wave 3"},
        {"proj":"Cluster Soluções de Pagamento e Conciliação","media":70.0,"wave":"Wave 3"},
        {"proj":"Contadoria","media":66.8,"wave":"Piloto"},
        {"proj":"Plataforma de segurança Safer","media":56.8,"wave":"Piloto"},
        {"proj":"Tribo Contas e Tarifas","media":56.0,"wave":"Wave 3"},
        {"proj":"Plataforma A3C","media":46.9,"wave":"Piloto"},
        {"proj":"CONSIGNADO - Pleito de Priorização INSS","media":39.0,"wave":"Wave 3"},
        {"proj":"CRM","media":35.0,"wave":"Wave 2"},
        {"proj":"Sala Core","media":33.0,"wave":"Wave 2"},
        {"proj":"Transformação","media":32.7,"wave":"Piloto"},
        {"proj":"Massificado","media":29.1,"wave":"Wave 2"},
        {"proj":"BSIS","media":28.0,"wave":"Wave 3"},
        {"proj":"CORE","media":27.0,"wave":"Wave 3"},
        {"proj":"GACB Leg 1","media":26.2,"wave":"Wave 3"},
        {"proj":"LOTES","media":25.0,"wave":"Wave 3"},
        {"proj":"BackOffice-Resumo de Conta","media":25.0,"wave":"Wave 3"},
        {"proj":"Cobrança","media":22.3,"wave":"Wave 3"},
        {"proj":"Conta Pj","media":20.0,"wave":"Wave 3"},
        {"proj":"Garantia Automática","media":20.0,"wave":"Wave 3"},
        {"proj":"Operações","media":18.6,"wave":"Wave 3"},
        {"proj":"BSIA","media":18.0,"wave":"Wave 3"},
        {"proj":"ATM","media":16.0,"wave":"Wave 3"},
        {"proj":"Varejo","media":16.0,"wave":"Wave 3"},
        {"proj":"MICROSERVIÇOS","media":15.0,"wave":"Wave 3"},
        {"proj":"EY-Adquirencia Master QR Code","media":15.0,"wave":"Wave 3"},
        {"proj":"Canais Digitais Pessoa Jurídica","media":14.3,"wave":"Wave 3"},
        {"proj":"PO Abreconta PF Digital","media":14.0,"wave":"Wave 3"},
        {"proj":"PF - I36.0-CS Mantem Conta","media":14.0,"wave":"Wave 3"},
        {"proj":"Refuge","media":13.5,"wave":"Wave 3"},
        {"proj":"Manutenção Série PF","media":13.0,"wave":"Wave 3"},
        {"proj":"S1000 Integração|Pessoa Física","media":12.5,"wave":"Wave 3"},
        {"proj":"RH","media":12.1,"wave":"Wave 3"},
        {"proj":"BSAN","media":12.0,"wave":"Wave 3"},
        {"proj":"Ouvidoria","media":12.0,"wave":"Wave 3"},
        {"proj":"EXPERIENCIA FUNCIONARIO","media":10.5,"wave":"Wave 3"},
        {"proj":"Garantias","media":10.5,"wave":"Wave 3"},
        {"proj":"PIX-CPJ","media":9.2,"wave":"Wave 2"},
        {"proj":"CONSIGNADO - E-Social","media":8.8,"wave":"Wave 3"},
        {"proj":"VATINTR","media":7.0,"wave":"Wave 3"},
        {"proj":"INTERNACIONAL E CÂMBIO","media":6.6,"wave":"Wave 3"},
        {"proj":"CONSIGNADO - Mktplace Consignado","media":6.3,"wave":"Wave 3"},
        {"proj":"BSPI","media":6.0,"wave":"Wave 3"},
        {"proj":"Consignado - Portabilidade","media":6.0,"wave":"Wave 4"},
        {"proj":"PDPJ","media":6.0,"wave":"Wave 3"},
        {"proj":"Interestellar","media":5.0,"wave":"Wave 3"},
        {"proj":"Plataforma Atendimento","media":4.2,"wave":"Wave 1"},
        {"proj":"MBPF","media":4.0,"wave":"Wave 3"},
        {"proj":"Tribo Canais Assistidos","media":4.0,"wave":"Wave 3"},
        {"proj":"Tesouraria","media":2.0,"wave":"Wave 2"},
        {"proj":"AFLUENTES","media":0.0,"wave":"Wave 3"}
      ];

      // Lista atualizada de projetos com base nos dados fornecidos
      const projects = [
        {"proj":"AFLUENTES","total":1,"sem":1},
        {"proj":"PROJETO PT-W50594","total":1,"sem":0},
        {"proj":"Investimentos","total":1,"sem":0},
        {"proj":"ATACADO","total":2,"sem":0},
        {"proj":"VATINTR","total":1,"sem":0},
        {"proj":"BRAIN","total":27,"sem":3},
        {"proj":"Consignado","total":11,"sem":1},
        {"proj":"CONSIGNADO - E-Social","total":10,"sem":2},
        {"proj":"CONSIGNADO - Mktplace Consignado","total":3,"sem":0},
        {"proj":"CONSIGNADO - Pleito de Priorização INSS","total":1,"sem":0},
        {"proj":"Consignado - Portabilidade","total":3,"sem":1},
        {"proj":"Soluçoes PJ","total":10,"sem":1},
        {"proj":"Cluster Soluções de Pagamento e Conciliação","total":1,"sem":0},
        {"proj":"Massificado","total":9,"sem":0},
        {"proj":"Sala Core","total":8,"sem":0},
        {"proj":"Tribo Canais Assistidos","total":1,"sem":0},
        {"proj":"Bradesco Global Solutions","total":8,"sem":1},
        {"proj":"Abertura de Contas","total":6,"sem":0},
        {"proj":"Tribo Contas e Tarifas","total":1,"sem":0},
        {"proj":"Plataforma Atendimento","total":6,"sem":2},
        {"proj":"CONSÓRCIO | Consorcio","total":4,"sem":0},
        {"proj":"Contadoria","total":8,"sem":0},
        {"proj":"Interestellar","total":2,"sem":0},
          {"proj":"Transformação","total":7,"sem":0},
        {"proj":"Plataforma de segurança Safer","total":38,"sem":1},
        {"proj":"MBPF","total":3,"sem":1},
        {"proj":"PDPJ","total":1,"sem":0},
        {"proj":"PIX-CPF","total":1,"sem":0},
        {"proj":"PIX-CPJ","total":5,"sem":1},
        {"proj":"Site Gestor","total":1,"sem":0},
        {"proj":"Open Finance","total":5,"sem":0},
        {"proj":"CRM","total":11,"sem":0},
        {"proj":"BSPI","total":7,"sem":2},
        {"proj":"INTERNACIONAL E CÂMBIO","total":5,"sem":0},
        {"proj":"Reabilitação Financeira","total":31,"sem":3},
        {"proj":"SCAP","total":3,"sem":0},
        {"proj":"Tesouraria","total":1,"sem":0},
        {"proj":"Internet Banking","total":2,"sem":0},
        {"proj":"Plataforma A3C","total":14,"sem":0}
      ];

      // Casos de uso (totais e ativos)
      const useCases = [
        {"Caso de Uso":"Criação de cenários de testes","total":165,"active":155,"interactions":5873},
        {"Caso de Uso":"Ponto de Função","total":83,"active":73,"interactions":1579},
        {"Caso de Uso":"Criação de diagrama de sequência","total":5,"active":5,"interactions":421},
        {"Caso de Uso":"Criação de histórias de usuário","total":5,"active":5,"interactions":143}
      ];

      // KPIs e textos auxiliares
      function updateAllMetrics() {
        const totalProjetos = 39;
        const totalUsuarios = 258;
        const usuariosSemInteracao = 20;
        const usuariosAtivos = totalUsuarios - usuariosSemInteracao;
        const taxaAdocao = ((usuariosAtivos / totalUsuarios) * 100).toFixed(1);

        let projetosComSemInteracao = 0;
        for (let i = 0; i < projects.length; i++) {
          if (projects[i].sem > 0) projetosComSemInteracao++;
        }

        document.getElementById('k_total').textContent = totalUsuarios;
        document.getElementById('k_ativos').textContent = usuariosAtivos;
        document.getElementById('k_sem').textContent = usuariosSemInteracao;
        document.getElementById('k_sem_pct').textContent = ((usuariosSemInteracao / totalUsuarios) * 100).toFixed(1) + '%';
        document.getElementById('k_adocao').textContent = taxaAdocao + '%';
        document.getElementById('k_taxa_v').textContent = taxaAdocao + '%';
        document.getElementById('k_taxa_desc').textContent = `${usuariosAtivos} de ${totalUsuarios} usuários ativos`;

        // Média global corrigida: interações / TOTAL de usuários
        const totalInteracoes = 8016;
        document.getElementById('k_inter').textContent = totalInteracoes;
        const mediaGlobal = (totalInteracoes / totalUsuarios).toFixed(1);
        document.getElementById('k_media_global').textContent = `Média: ${mediaGlobal} por usuário`;

        // Projetos com/sem interação
        document.getElementById('projetos_sem_interacao').textContent = projetosComSemInteracao;
        document.getElementById('total_projetos').textContent = totalProjetos;
        document.getElementById('k_proj_total').textContent = totalProjetos;
      }

      /* ====== GRÁFICO 1: Média de interações por projeto (corrigido para total de usuários) ====== */
      function calculateAdjustedAverageByProject(){
        const projectMap = {};
        projects.forEach(p => {
          projectMap[p.proj] = {
            totalUsers: p.total,
            activeUsers: p.total - p.sem,
            inactiveUsers: p.sem
          };
        });

        const waveDataByProject = {};
        RAW_WAVE.forEach(r => {
          if (!waveDataByProject[r.proj]) waveDataByProject[r.proj] = [];
          waveDataByProject[r.proj].push(r);
        });

        const adjustedAverages = [];
        for (const projectName in projectMap) {
          if (waveDataByProject[projectName]) {
            const pdata = projectMap[projectName];
            let maxMedia = -Infinity, dominantWave = '';
            waveDataByProject[projectName].forEach(wv => {
              if (wv.media > maxMedia) { maxMedia = wv.media; dominantWave = wv.wave; }
            });

            // Total de interações estimado = média por ativo * nº de ativos
            const estimatedTotalInteractions = maxMedia * pdata.activeUsers;
            // Média corrigida = total estimado / total de usuários (ativos + inativos)
            const adjustedAverage = pdata.totalUsers > 0 ? estimatedTotalInteractions / pdata.totalUsers : 0;

            adjustedAverages.push({
              proj: projectName,
              media: +adjustedAverage.toFixed(1),
              originalMedia: maxMedia,  // média por usuário ativo
              wave: dominantWave,
              totalUsers: pdata.totalUsers,
              activeUsers: pdata.activeUsers,
              inactiveUsers: pdata.inactiveUsers,
              totalInteractions: Math.round(estimatedTotalInteractions)
            });
          }
        }
        return adjustedAverages.sort((a,b)=>b.media-a.media);
      }

      (function renderAvgByProject(){
        const data = calculateAdjustedAverageByProject();
        const labels = data.map(d => d.proj);
        const values = data.map(d => d.media);

        const css = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
        const palette = { piloto: css('--piloto'), wave1: css('--wave1'), wave2: css('--wave2'), wave3: css('--wave3'), wave4: css('--wave4') };
        const colors = data.map(d => {
          const w = (d.wave || '').toLowerCase();
          if (w.includes('piloto')) return palette.piloto;
          if (w.includes('wave 1')) return palette.wave1;
          if (w.includes('wave 2')) return palette.wave2;
          if (w.includes('wave 4')) return palette.wave4;
          return palette.wave3;
        });

        const maxVal = Math.max(...values, 1);
        const niceMax = Math.ceil(maxVal/10)*10;
        const headroom = Math.max(2, Math.round(niceMax*0.06));

        new Chart(document.getElementById('avgByProject'), {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Média de interações',
              data: values,
              backgroundColor: colors,
              borderRadius: 6,
              categoryPercentage: 0.72,
              barPercentage: 0.9,
              maxBarThickness: 22,
              datalabels: {
                color: '#fff',
                anchor: 'end',
                align: 'end',
                offset: 6,
                formatter: v => v.toLocaleString('pt-BR', { maximumFractionDigits: 1 }),
                font: { weight: 'bold' }
              }
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: { top: 18, right: 8, left: 8, bottom: 50 } },
            plugins: {
              legend: { display: false },
              tooltip: {
                enabled: true,
                callbacks: {
                  afterLabel: (ctx) => {
                    const projectData = data[ctx.dataIndex];
                    const wave = projectData.wave || '';
                    return [
                      `Wave dominante: ${wave}`,
                      `Total de usuários: ${projectData.totalUsers}`,
                      `Usuários ativos: ${projectData.activeUsers}`,
                      `Usuários sem interação: ${projectData.inactiveUsers}`,
                      `Média por usuário ativo: ${projectData.originalMedia.toFixed(1)}`,
                      `Média por todos usuários: ${projectData.media}`
                    ];
                  }
                }
              }
            },
            scales: {
              x: { grid: { display: false }, ticks: { autoSkip: false, maxRotation: 36, minRotation: 36, font: { weight: 'bold', size: 11 } } },
              y: { beginAtZero: true, suggestedMax: niceMax + headroom, ticks: { stepSize: Math.max(5, Math.round((niceMax + headroom)/9)), precision: 0 } }
            }
          }
        });
      })();

      (function renderProjectsStacked(){
        const sortedProjects = [...projects].sort((a, b) => b.total - a.total);
        const labels = sortedProjects.map(p => p.proj);
        const dataSem = sortedProjects.map(p => p.sem);
        const dataCom = sortedProjects.map(p => Math.max(p.total - p.sem, 0));

        updateAllMetrics();

        const okColor = getComputedStyle(document.documentElement).getPropertyValue('--ok').trim();
        const attColor = getComputedStyle(document.documentElement).getPropertyValue('--att').trim();

        // Configuração modificada para o gráfico de projetos
        new Chart(document.getElementById('projectsInteractionStacked'), {
          type: 'bar',
          data: {
            labels,
            datasets: [
              {
                label: 'Com interação',
                data: dataCom,
                backgroundColor: okColor,
                borderRadius: 4,
                categoryPercentage: 0.8,
                barPercentage: 0.9,
                datalabels: {
                  color: '#ffffff',
                  display: ctx => ctx.dataset.data[ctx.dataIndex] > 0,
                  formatter: v => v || '',
                  align: 'center',
                  anchor: 'center'
                }
              },
              {
                label: 'Sem interação',
                data: dataSem,
                backgroundColor: attColor,
                borderRadius: 4,
                categoryPercentage: 0.8,
                barPercentage: 0.9,
                datalabels: {
                  color: '#ffffff',
                  display: ctx => ctx.dataset.data[ctx.dataIndex] > 0,
                  formatter: v => v || '',
                  align: 'center',
                  anchor: 'center',
                  font: { weight: 'bold' }
                }
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
              padding: { top: 10, right: 10, bottom: 10, left: 10 }
            },
            scales: {
              x: {
                stacked: true,
                grid: { display: false },
                ticks: { 
                  maxRotation: 45, 
                  minRotation: 45, 
                  font: { weight: 'bold', size: 10 },
                  autoSkip: false // Impede que rótulos sejam pulados
                }
              },
              y: {
                stacked: true,
                beginAtZero: true,
                grid: { display: false },
                ticks: { precision: 0 }
              }
            },
            plugins: {
              legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 10, boxHeight: 10 } },
              tooltip: { enabled: true, callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y} usuário(s)` } },
              datalabels: { color: '#ffffff', font: { size: 11 } }
            }
          }
        });
      })();

      // CARD 3: Profissionais por Caso de Uso
      (function renderProfessionalsByUseCase() {
        const sortedUseCases = [...useCases].sort((a, b) => b.total - a.total);
        const labels = sortedUseCases.map(uc => uc["Caso de Uso"]);
        const dataActive = sortedUseCases.map(uc => uc.active);
        const dataInactive = sortedUseCases.map(uc => uc.total - uc.active);

        const okColor = getComputedStyle(document.documentElement).getPropertyValue('--ok').trim();
        const attColor = getComputedStyle(document.documentElement).getPropertyValue('--att').trim();

        new Chart(document.getElementById('professionalsByUseCase'), {
          type: 'bar',
          data: {
            labels,
            datasets: [
              {
                label: 'Com interação',
                data: dataActive,
                backgroundColor: okColor,
                borderRadius: 4,
                categoryPercentage: 0.8,
                barPercentage: 0.9,
                datalabels: {
                  color: '#ffffff',
                  display: ctx => ctx.dataset.data[ctx.dataIndex] > 0,
                  formatter: v => v || '',
                  align: 'center',
                  anchor: 'center'
                }
              },
              {
                label: 'Sem interação',
                data: dataInactive,
                backgroundColor: attColor,
                borderRadius: 4,
                categoryPercentage: 0.8,
                barPercentage: 0.9,
                datalabels: {
                  color: '#ffffff',
                  display: ctx => ctx.dataset.data[ctx.dataIndex] > 0,
                  formatter: v => v || '',
                  align: 'center',
                  anchor: 'center',
                  font: { weight: 'bold' }
                }
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                stacked: true,
                grid: { display: false },
                ticks: { maxRotation: 45, minRotation: 45, font: { weight: 'bold', size: 10 } }
              },
              y: {
                stacked: true,
                beginAtZero: true,
                grid: { display: false },
                ticks: { precision: 0 }
              }
            },
            plugins: {
              legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 10, boxHeight: 10 } },
              tooltip: {
                enabled: true,
                callbacks: {
                  afterBody: (tooltipItems) => {
                    const idx = tooltipItems[0].dataIndex;
                    const uc = sortedUseCases[idx];
                    const percentActive = ((uc.active / uc.total) * 100).toFixed(1);
                    const avgInteractions = (uc.interactions / uc.total).toFixed(1); // média por TOTAL
                    return [
                      `Taxa de adoção: ${percentActive}%`,
                      `Total de interações: ${uc.interactions}`,
                      `Média por usuário (total): ${avgInteractions}`
                    ];
                  }
                }
              },
               datalabels: { color: '#ffffff', font: { size: 11 } }
            }
          }
        });
      })();

      updateAllMetrics();
    });

    function goBack() {
      window.location.href = 'https://marianacintra81.github.io/Bradesco-GEN-AI/GenAI%20Hub%20%20Centro%20de%20Inovacao.html';
    }
  </script>
</body>
</html>
