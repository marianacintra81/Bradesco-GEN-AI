<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Visão Executiva_Adoção GEN AI</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Comparativo - Implantações GenAI</title>

  <!-- Chart.js + Plugin de DataLabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

  <!-- XLSX (ler Excel no navegador) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Fonte / Ícones -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    :root{
      --background: #0c0e14;
      --card-bg: #1e2130;
      --card-bg-hover: #272936;
      --card-bg-secondary: #151823;

      --text: #ffffff;
      --muted: #a3a8c3;

      --red-bradesco: #cc0000;
      --blue-bradesco: #0033A0;
      --purple-highlight: #7B68EE;
      --cyan-highlight: #00e5ff;

      --piloto: var(--cyan-highlight);
      --wave1: var(--purple-highlight);
      --wave2: var(--red-bradesco);
      --wave3: #ffa500;
      --wave4: #1dd1a1;

      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.4);
      --radius: 16px;
    }

    body {
      background: var(--background);
      color: var(--text);
      padding: 18px;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(0, 51, 160, 0.15) 0%, rgba(0, 51, 160, 0) 70%),
        radial-gradient(circle at 90% 80%, rgba(204, 0, 0, 0.15) 0%, rgba(204, 0, 0, 0) 70%);
    }

    .container { max-width: 1280px; margin: 0 auto; }

    header {
      position: relative;
      display: flex; justify-content: center;
      margin-bottom: 18px; padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
    }

    header h1 {
      font-size: 28px; font-weight: 800; margin-bottom: 8px; text-align: center;
      background: linear-gradient(135deg, #0033A0, #7B68EE, #cc0000);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }

    /* Abas sob o título */
    .tabs { display:flex; gap:8px; justify-content:center; margin:-6px 0 14px; }
    .tab {
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px;
      background: linear-gradient(135deg, var(--blue-bradesco), var(--purple-highlight));
      color:#fff; font-weight:800; letter-spacing:.2px; text-decoration:none; box-shadow: var(--shadow);
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease;
    }
    .tab:hover { transform: translateY(-1px); box-shadow: var(--shadow-hover); opacity:.95; }
    .tab i{ font-size:14px; }

    /* Botão Voltar */
    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      color: #ffffff;
      border: none;
      border-radius: 50%;
      width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; cursor: pointer; z-index: 1000;
      box-shadow: var(--shadow); transition: all 0.3s ease;
      text-decoration: none;
    }
    .back-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #7B68EE, #0033A0);
    }

    /* KPIs */
    .kpis {
      display: grid; grid-template-columns: repeat(6, 1fr);
      gap: 10px; margin: 18px 0;
    }

    .kpi {
      position: relative; background: var(--card-bg); border-radius: var(--radius);
      padding: 14px 14px 12px; box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, .06);
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      overflow: hidden; --accent: #6b7280; text-align: left;
    }
    .kpi:hover { transform: translateY(-2px); background: var(--card-bg-hover); border-color: rgba(255, 255, 255, .12); box-shadow: var(--shadow-hover); }
    .kpi-head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .chip { width: 32px; height: 32px; border-radius: 999px; display: inline-flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, .06); box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .08); color: var(--accent); }
    .kpi h4 { font-size: 11px; letter-spacing: .3px; color: var(--muted); font-weight: 800; text-transform: uppercase; }
    .kpi .v { font-size: 26px; font-weight: 900; line-height: 1; margin: 4px 0 6px; }
    .kpi small { color: var(--muted); font-size: 12px; }
    .kpi strong { font-weight: 900; color: #fff; }

    .kpi--total { --accent: var(--blue-bradesco); }
    .kpi--ativos { --accent: #22c55e; }
    .kpi--sem { --accent: var(--red-bradesco); }
    .kpi--inter { --accent: var(--cyan-highlight); }
    .kpi--proj { --accent: var(--blue-bradesco); }
    .kpi--adocao { --accent: #22c55e; }

    /* Seção de título */
    .section-title {
      font-size: 22px;
      font-weight: 800;
      margin: 30px 0 15px;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    /* Tabela de Casos de Uso */
    .use-case-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-bottom: 20px;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .use-case-table thead th {
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      color: white;
      padding: 14px 16px;
      text-align: left;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0.5px;
    }

    .use-case-table tbody tr {
      background: var(--card-bg);
      transition: background 0.2s ease;
      cursor: pointer;
    }

    .use-case-table tbody tr:hover {
      background: var(--card-bg-hover);
    }

    .use-case-table tbody tr.selected {
      background: rgba(123, 104, 238, 0.2);
      border-left: 3px solid var(--purple-highlight);
    }

    .use-case-table td {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 15px;
    }

    .use-case-table .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .use-case-table .status-yes {
      background-color: #22c55e;
    }

    .use-case-table .status-partial {
      background-color: #ffa500;
    }

    .use-case-table .status-no {
      background-color: var(--red-bradesco);
    }

    /* Cards de detalhes de caso de uso */
    .use-case-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .detail-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, .06);
      transition: transform .18s ease, background .18s ease;
    }

    .detail-card:hover {
      transform: translateY(-2px);
      background: var(--card-bg-hover);
      box-shadow: var(--shadow-hover);
    }

    .detail-card h3 {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .detail-card .detail-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .detail-card .detail-desc {
      font-size: 13px;
      color: var(--muted);
    }

    /* Perfis (cards de quantidade) */
    .profiles { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin: 12px 0 6px; }
    .profiles .kpi { text-align: center; }
    .profiles .kpi .kpi-head { justify-content: center; }
    .profiles .kpi .v { font-size: 24px; }

    /* Estilos para a seção de Visão por Projeto */
    .filter-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      background: var(--card-bg);
      padding: 12px 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .filter-container label {
      margin-right: 12px;
      font-weight: 600;
      color: var(--muted);
    }

    .filter-select {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      min-width: 250px;
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--purple-highlight);
      box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.3);
    }

    .project-summary {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .project-header h3 {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .project-badge {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .project-kpis {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }

    .project-kpi {
      display: flex;
      align-items: center;
      background: var(--card-bg-secondary);
      padding: 15px;
      border-radius: 12px;
      transition: transform 0.2s ease, background-color 0.2s ease;
    }

    .project-kpi:hover {
      transform: translateY(-3px);
      background: var(--card-bg-hover);
    }

    .kpi-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(123, 104, 238, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      color: var(--purple-highlight);
      font-size: 18px;
    }

    .kpi-content {
      flex: 1;
    }

    .kpi-value {
      font-size: 22px;
      font-weight: 800;
      line-height: 1.2;
    }

    .kpi-label {
      font-size: 12px;
           color: var(--muted);
    }

    .project-use-cases {
      margin-bottom: 25px;
    }

    .project-use-cases h4, .project-chart-container h4 {
      font-size: 16px;
      margin-bottom: 15px;
      color: var(--muted);
      font-weight: 600;
    }

    .use-case-matrix {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
    }

    .use-case-matrix th, .use-case-matrix td {
      padding: 12px 15px;
      text-align: center;
      font-size: 14px;
    }

    .use-case-matrix th {
      background: var(--card-bg-secondary);
      font-weight: 600;
      color: var(--muted);
    }

    .use-case-matrix td:first-child {
      text-align: left;
      font-weight: 600;
    }

    .use-case-matrix tr:nth-child(odd) {
      background: rgba(255, 255, 255, 0.03);
    }

    .use-case-matrix tr:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .has-use-case {
      color: #22c55e;
      font-weight: 700;
    }

    .partial-use-case {
      color: #ffa500;
      font-weight: 700;
    }

    .no-use-case {
      color: #888;
    }

    .project-chart-container {
      margin-top: 25px;
    }

    .project-chart-container .chart-wrap {
      height: 300px;
    }

    /* ======= Gráficos ======= */
    .chart-wrap{
      background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 12px 12px 8px; border: 1px solid rgba(255,255,255,.06);
      min-height: 0; height: 260px;
      position: relative; overflow: hidden;
      transition: box-shadow .18s ease, border-color .18s ease;
      margin-top: 10px;
    }
    .chart-wrap:hover{ box-shadow: var(--shadow-hover); border-color: rgba(255,255,255,.12); }

    .chart-title{
      font-weight: 800; margin: 6px 8px 0; line-height: 1.2;
      background: linear-gradient(135deg, #0033A0, #7B68EE);
      -webkit-background-clip: text; background-clip: text; color: transparent; display:inline-block;
    }

    .chart-wrap canvas{
      position: absolute; inset: 36px 8px 8px 8px;
      width: calc(100% - 16px) !important;
      height: calc(100% - 44px) !important;
      display: block;
    }

    /* UM gráfico por linha (sempre 1 coluna) */
    .charts-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }

    @media (max-width: 1100px) {
      .kpis { grid-template-columns: repeat(3, 1fr); }
      .profiles { grid-template-columns: repeat(3, 1fr); }
      .use-case-details { grid-template-columns: repeat(2, 1fr); }
      .project-kpis { grid-template-columns: repeat(2, 1fr); }
      .use-case-matrix { display: block; overflow-x: auto; }
    }
    @media (max-width: 720px) {
      .kpis { grid-template-columns: repeat(2, 1fr); }
      .profiles { grid-template-columns: repeat(2, 1fr); }
      .use-case-details { grid-template-columns: 1fr; }
      .project-kpis { grid-template-columns: 1fr; }
    }
    @media (max-width: 480px) {
      .kpis { grid-template-columns: 1fr; }
      .profiles { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div><h1>Adoção GEN AI Bradesco</h1></div>
    </header>

  

    <!-- Botão Voltar -->
    <a href="https://marianacintra81.github.io/Bradesco-GEN-AI/Menu%20Copilot%20e%20PromptX.html"
        class="back-button" aria-label="Voltar para a página anterior">
      <i class="fas fa-arrow-left" aria-hidden="true"></i>
    </a>

    <!-- KPIs -->
    <section class="kpis" id="kpis">
      <div class="kpi kpi--total">
        <div class="kpi-head"><div class="chip"><i class="fas fa-users"></i></div><h4>Total de Profissionais</h4></div>
        <div class="v" id="k_total">—</div>
        <small>Treinados</small>
      </div>

      <div class="kpi kpi--ativos">
        <div class="kpi-head"><div class="chip"><i class="fas fa-user-check"></i></div><h4>Usuários ativos</h4></div>
        <div class="v" id="k_ativos">—</div>
        <small><strong id="k_adocao">—</strong> de adoção</small>
      </div>

      <div class="kpi kpi--sem">
        <div class="kpi-head"><div class="chip"><i class="fas fa-user-clock"></i></div><h4>Usuários sem interação</h4></div>
        <div class="v" id="k_sem">—</div>
        <small><strong id="k_sem_pct">—</strong> do total</small>
      </div>

      <div class="kpi kpi--inter">
        <div class="kpi-head"><div class="chip"><i class="fas fa-bolt"></i></div><h4>Total de Interações</h4></div>
        <div class="v" id="k_inter">—</div>
        <small id="k_media_global">—</small>
      </div>

      <div class="kpi kpi--proj">
        <div class="kpi-head"><div class="chip"><i class="fas fa-diagram-project"></i></div><h4>Projetos envolvidos</h4></div>
        <div class="v" id="k_proj_total">—</div>
        <small>Somatório de projetos mapeados</small>
      </div>

      <div class="kpi kpi--adocao">
        <div class="kpi-head"><div class="chip"><i class="fas fa-gauge-high"></i></div><h4>Taxa de Adoção (geral)</h4></div>
        <div class="v" id="k_taxa_v">—</div>
        <small id="k_taxa_desc">—</small>
      </div>
    </section>

    <!-- Distribuição por Perfil -->
    <section class="profiles" id="profilesGrid" aria-label="Distribuição por Perfil"></section>

    <!-- Treinamento & Cobertura por Caso de Uso -->
    <h2 class="section-title">Treinamento & Cobertura por Caso de Uso</h2>
    
    <table class="use-case-table" id="useCaseTable">
      <thead>
        <tr>
          <th>Caso de Uso</th>
          <th>Profissionais Treinados</th>
          <th>Projetos Envolvidos</th>
          <th>Mede Interação?</th>
        </tr>
      </thead>
      <tbody>
        <tr data-id="code-review" class="selected">
          <td>Agente Code Review (Java)</td>
          <td>45</td>
          <td>6</td>
          <td><span class="status-indicator status-yes"></span>Sim</td>
        </tr>
        <tr data-id="github-copilot">
          <td>GitHub Copilot</td>
          <td>120</td>
          <td>10</td>
          <td><span class="status-indicator status-partial"></span>Parcial</td>
        </tr>
        <tr data-id="testes-backend">
          <td>Agente Testes Automatizados BackEnd</td>
          <td>80</td>
          <td>5</td>
          <td><span class="status-indicator status-no"></span>Não</td>
        </tr>
        <tr data-id="prompt-engineering">
          <td>Agente de Cobol</td>
          <td>65</td>
          <td>8</td>
          <td><span class="status-indicator status-yes"></span>Sim</td>
        </tr>
        <tr data-id="data-analysis">
          <td>Agente Padronização de dados</td>
          <td>35</td>
          <td>4</td>
          <td><span class="status-indicator status-partial"></span>Parcial</td>
        </tr>
      </tbody>
    </table>

    <!-- Cards de detalhes do caso de uso selecionado -->
    <section class="use-case-details" id="useCaseDetails">
      <div class="detail-card">
        <h3>Profissionais Treinados</h3>
        <div class="detail-value" id="detail-trained">45</div>
        <div class="detail-desc">Desenvolvedores capacitados para Code Review com IA</div>
      </div>
      <div class="detail-card">
        <h3>Projetos Envolvidos</h3>
        <div class="detail-value" id="detail-projects">6</div>
        <div class="detail-desc">Projetos ativos utilizando a ferramenta</div>
      </div>
      <div class="detail-card">
        <h3>Taxa de Adoção</h3>
        <div class="detail-value" id="detail-adoption">87%</div>
        <div class="detail-desc">Dos profissionais treinados que utilizam ativamente</div>
      </div>
    </section>

    <!-- MOVIDO: Gráficos para depois da seção de casos de uso -->
    <h2 class="section-title">Análise de Interações</h2>
    <div class="charts-grid">
      <section class="chart-wrap">
        <div class="chart-title">Interações por Mês</div>
        <canvas id="interactionsByMonth"></canvas>
      </section>

      <section class="chart-wrap">
        <div class="chart-title">Interações por Perfil</div>
        <canvas id="interactionsByProfile"></canvas>
      </section>
    </div>

    <!-- Visão por Projeto -->
    <h2 class="section-title">Visão por Projeto</h2>

    <!-- Filtro de projetos -->
    <div class="filter-container">
      <label for="project-filter">Filtrar por projeto:</label>
      <select id="project-filter" class="filter-select">
        <option value="all">Todos os projetos</option>
        <option value="projeto-a">Projeto A - Modernização Core</option>
        <option value="projeto-b">Projeto B - Open Finance</option>
        <option value="projeto-c">Projeto C - Canais Digitais</option>
        <option value="projeto-d">Projeto D - Automação BackOffice</option>
        <option value="projeto-e">Projeto E - Análise de Crédito</option>
      </select>
    </div>

    <!-- Resumo do projeto selecionado -->
    <div class="project-summary">
      <div class="project-header">
        <h3 id="project-name">Visão Consolidada - Todos os Projetos</h3>
        <span class="project-badge" id="project-status">Ativo</span>
      </div>
      
      <!-- KPIs do projeto -->
      <div class="project-kpis">
        <div class="project-kpi">
          <div class="kpi-icon"><i class="fas fa-users"></i></div>
          <div class="kpi-content">
            <div class="kpi-value" id="project-professionals">351</div>
            <div class="kpi-label">Profissionais Treinados</div>
          </div>
        </div>
        
        <div class="project-kpi">
          <div class="kpi-icon"><i class="fas fa-check-circle"></i></div>
          <div class="kpi-content">
            <div class="kpi-value" id="project-adoption">88%</div>
            <div class="kpi-label">Taxa de Adoção</div>
          </div>
        </div>
        
        <div class="project-kpi">
          <div class="kpi-icon"><i class="fas fa-tools"></i></div>
          <div class="kpi-content">
            <div class="kpi-value" id="project-use-cases">5</div>
            <div class="kpi-label">Casos de Uso Implementados</div>
          </div>
        </div>
        
        <div class="project-kpi">
          <div class="kpi-icon"><i class="fas fa-bolt"></i></div>
          <div class="kpi-content">
            <div class="kpi-value" id="project-interactions">13.464</div>
            <div class="kpi-label">Total de Interações</div>
          </div>
        </div>
      </div>
      
      <!-- Tabela de casos de uso por projeto -->
      <div class="project-use-cases">
        <h4>Casos de Uso por Perfil</h4>
        <table class="use-case-matrix">
          <thead>
            <tr>
              <th>Perfil</th>
              <th>Profissionais</th>
              <th>Agente Code Review</th>
              <th>GitHub Copilot</th>
              <th>Agente Testes</th>
              <th>Agente Cobol</th>
              <th>Agente Dados</th>
              <th>Média de Casos</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>DEV</td>
              <td>64</td>
              <td class="has-use-case">95%</td>
              <td class="has-use-case">100%</td>
              <td class="has-use-case">75%</td>
                   <td class="no-use-case">10%</td>
              <td class="no-use-case">5%</td>
              <td>2.85</td>
            </tr>
            <tr>
              <td>QA</td>
              <td>176</td>
              <td class="has-use-case">80%</td>
              <td class="partial-use-case">45%</td>
              <td class="has-use-case">100%</td>
              <td class="no-use-case">0%</td>
              <td class="no-use-case">15%</td>
              <td>2.40</td>
            </tr>
            <tr>
              <td>Scrum Master</td>
              <td>93</td>
              <td class="no-use-case">10%</td>
              <td class="partial-use-case">60%</td>
              <td class="no-use-case">5%</td>
              <td class="no-use-case">0%</td>
              <td class="partial-use-case">40%</td>
              <td>1.15</td>
            </tr>
            <tr>
              <td>Analista de Dados</td>
              <td>6</td>
              <td class="no-use-case">0%</td>
              <td class="partial-use-case">50%</td>
              <td class="no-use-case">0%</td>
              <td class="no-use-case">0%</td>
              <td class="has-use-case">100%</td>
              <td>1.50</td>
            </tr>
            <tr>
              <td>Analista de Negócios</td>
              <td>7</td>
              <td class="no-use-case">0%</td>
              <td class="partial-use-case">40%</td>
              <td class="no-use-case">0%</td>
              <td class="has-use-case">85%</td>
              <td class="partial-use-case">60%</td>
              <td>1.85</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Gráfico de evolução da adoção no projeto -->
      <div class="project-chart-container">
        <h4>Evolução da Adoção no Projeto</h4>
        <div class="chart-wrap">
          <canvas id="projectAdoptionChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Input oculto (Ctrl+U) -->
  <input type="file" id="hiddenSheetInput" accept=".xlsx,.xls,.csv" style="display:none" />

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ===== Chart.js defaults =====
      Chart.register(ChartDataLabels);
      Chart.defaults.color = '#ffffff';
      Chart.defaults.font.family = 'Inter, sans-serif';
      Chart.defaults.responsive = true;
      Chart.defaults.maintainAspectRatio = false;
      Chart.defaults.animation = { duration: 0 };

      // =========================
      // FIXOS MANUAIS (editar "na mão")
      // =========================
      const FIXED_ADOPTION_GENERAL_PCT = 92; // <-- edite aqui (ex: 92.)
      const FIXED_W4_ADOPTION_PCT      = 78.9;  // <-- edite aqui (ex: 68.9)
      const FIXED_W4_TAG_TEXT          = '71 de 103 ativos'; // <-- edite aqui

      // =========================
      // Persistência
      // =========================
      const STORAGE_KEY = 'genai_dashboard_metrics_v1';

      function saveMetricsToStorage(metrics) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            savedAt: new Date().toISOString(),
            metrics
          }));
        } catch (e) {
          console.warn('Não foi possível persistir no localStorage:', e);
        }
      }

      function loadMetricsFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          const parsed = JSON.parse(raw);
          return parsed && parsed.metrics ? parsed.metrics : null;
        } catch (e) {
          console.warn('Não foi possível ler do localStorage:', e);
          return null;
        }
      }

      function applyFixedAdoptionRates() {
        const general = Number(FIXED_ADOPTION_GENERAL_PCT);
        if (Number.isFinite(general)) {
          const generalTxt = general.toLocaleString('pt-BR', { minimumFractionDigits: 0, maximumFractionDigits: 2 }) + '%';
          const elK = document.getElementById('k_adocao');
          const elV = document.getElementById('k_taxa_v');
          if (elK) elK.textContent = generalTxt;
          if (elV) elV.textContent = generalTxt;
        }
      }

      // Helper: manter gráficos responsivos sem "pulos"
      const resizeCanvases = () => {
        document.querySelectorAll('.chart-wrap').forEach(card => {
          const canvas = card.querySelector('canvas');
          if(!canvas) return;
          const chart = Chart.getChart(canvas);
          if(chart){
            chart.resize();
            chart.update('none');
          }
        });
      };
      const ro = new ResizeObserver(resizeCanvases);
      ro.observe(document.body);

      /* ======= DATASETS ======= */

      // Mantido fixo (se quiser, posso adaptar para também vir da planilha)
      const monthlyInteractions = [
        { month: "Abril",    interactions: 124 },
        { month: "Maio",     interactions: 533 },
        { month: "Junho",    interactions: 353 },
        { month: "Julho",    interactions: 1116 },
        { month: "Agosto",   interactions: 2398 },
        { month: "Setembro", interactions: 2151 },
        { month: "Outubro",  interactions: 3750 },
        { month: "Novembro", interactions: 2518 }
      ];

      const profileInteractionsInitial = [
        { profile: 'QA',                   interactions: 7000, users: 176 },
        { profile: 'Scrum Master',         interactions: 4200, users: 93  },
        { profile: 'SRE',                  interactions: 700,  users: 5   },
        { profile: 'DEV',                  interactions: 900,  users: 64  },
        { profile: 'Analista de Negócios', interactions: 600,  users: 7   },
        { profile: 'Analista de Dados',    interactions: 64,   users: 6   }
      ];

      // Dados dos casos de uso
      const useCases = {
        'code-review': {
          name: 'Code Review (Java)',
          trained: 45,
          projects: 6,
          adoption: 87,
          description: 'Desenvolvedores capacitados para Code Review com IA',
          projectDesc: 'Projetos ativos utilizando a ferramenta',
          adoptionDesc: 'Dos profissionais treinados que utilizam ativamente',
          hasInteraction: true
        },
        'github-copilot': {
          name: 'GitHub Copilot',
          trained: 120,
          projects: 10,
          adoption: 75,
          description: 'Desenvolvedores treinados no GitHub Copilot',
          projectDesc: 'Projetos com integração Copilot',
          adoptionDesc: 'Taxa de uso contínuo após treinamento',
          hasInteraction: 'partial'
        },
        'testes-backend': {
          name: 'Testes Automatizados BackEnd',
          trained: 80,
          projects: 5,
          adoption: 62,
          description: 'QAs e DEVs treinados em automação com IA',
          projectDesc: 'Projetos com testes automatizados',
          adoptionDesc: 'Adoção da metodologia após treinamento',
          hasInteraction: false
        },
        'prompt-engineering': {
          name: 'Prompt Engineering',
          trained: 65,
          projects: 8,
          adoption: 92,
          description: 'Profissionais capacitados em engenharia de prompts',
          projectDesc: 'Projetos utilizando prompts otimizados',
          adoptionDesc: 'Taxa de aplicação das técnicas aprendidas',
          hasInteraction: true
        },
        'data-analysis': {
          name: 'Análise de Dados',
          trained: 35,
          projects: 4,
          adoption: 80,
          description: 'Analistas treinados em ferramentas de IA',
          projectDesc: 'Projetos de análise com suporte de IA',
          adoptionDesc: 'Uso contínuo das ferramentas após treinamento',
          hasInteraction: 'partial'
        }
      };

      // Dados dos projetos (simulados)
      const projectsData = {
        'all': {
          name: 'Visão Consolidada - Todos os Projetos',
          status: 'Ativo',
          professionals: 351,
          adoption: 88,
          useCases: 5,
          interactions: 13464,
          adoptionTrend: [65, 70, 75, 78, 82, 85, 88]
        },
        'projeto-a': {
          name: 'Projeto A - Modernização Core',
          status: 'Ativo',
          professionals: 120,
          adoption: 95,
          useCases: 4,
          interactions: 5280,
          adoptionTrend: [70, 78, 85, 90, 92, 94, 95]
        },
        'projeto-b': {
          name: 'Projeto B - Open Finance',
          status: 'Ativo',
          professionals: 85,
          adoption: 82,
          useCases: 3,
          interactions: 3200,
          adoptionTrend: [60, 65, 70, 75, 78, 80, 82]
        },
        'projeto-c': {
          name: 'Projeto C - Canais Digitais',
          status: 'Ativo',
          professionals: 65,
          adoption: 90,
          useCases: 5,
          interactions: 2800,
          adoptionTrend: [75, 80, 82, 85, 87, 89, 90]
        },
        'projeto-d': {
          name: 'Projeto D - Automação BackOffice',
          status: 'Ativo',
          professionals: 45,
          adoption: 78,
          useCases: 3,
          interactions: 1450,
          adoptionTrend: [50, 55, 60, 65, 70, 75, 78]
        },
        'projeto-e': {
          name: 'Projeto E - Análise de Crédito',
          status: 'Ativo',
          professionals: 36,
          adoption: 85,
          useCases: 2,
          interactions: 734,
          adoptionTrend: [65, 70, 75, 80, 82, 84, 85]
        }
      };

      // Variável para armazenar o chart de barras
      let interactionsByProfileChart;
      let projectAdoptionChart;

      function renderProfilesCards(profileList) {
        const grid = document.getElementById('profilesGrid');
        if (!grid) return;
        const ordered = [...profileList].sort((a,b) => (b.users||0) - (a.users||0));

        const iconByProfile = (p) => {
          const key = (p || '').toLowerCase();
          if (key.includes('scrum')) return 'fa-user-tie';
          if (key.includes('sre')) return 'fa-vial';
          if (key.includes('dev')) return 'fa-code';
          if (key.includes('qa')) return 'fa-bug';
          if (key.includes('negócios') || key.includes('negocios')) return 'fa-clipboard-list';
          if (key.includes('dados')) return 'fa-database';
          return 'fa-user';
        };

        const item = ({profile, users}) => `
          <div class="kpi">
            <div class="kpi-head">
              <div class="chip"><i class="fas ${iconByProfile(profile)}"></i></div>
              <h4>${profile}</h4>
            </div>
            <div class="v">${(users ?? 0).toLocaleString('pt-BR')}</div>
            <small>Qtde de profissionais</small>
          </div>
        `;
        grid.innerHTML = ordered.map(item).join('');
      }

      // Função para atualizar os detalhes do caso de uso selecionado
      function updateUseCaseDetails(useCaseId) {
        const useCase = useCases[useCaseId];
        if (!useCase) return;
        
        document.getElementById('detail-trained').textContent = useCase.trained;
        document.getElementById('detail-projects').textContent = useCase.projects;
        document.getElementById('detail-adoption').textContent = useCase.adoption + '%';
        
        // Atualiza as descrições
        document.getElementById('detail-trained').nextElementSibling.textContent = useCase.description;
        document.getElementById('detail-projects').nextElementSibling.textContent = useCase.projectDesc;
        document.getElementById('detail-adoption').nextElementSibling.textContent = useCase.adoptionDesc;
        
        // Remove a classe selected de todas as linhas
        document.querySelectorAll('#useCaseTable tbody tr').forEach(row => {
          row.classList.remove('selected');
        });
        
        // Adiciona a classe selected à linha do caso de uso selecionado
        document.querySelector(`#useCaseTable tbody tr[data-id="${useCaseId}"]`).classList.add('selected');
      }

      // Função para atualizar os dados do projeto selecionado
      function updateProjectView(projectId) {
        const project = projectsData[projectId];
        if (!project) return;
        
        // Atualiza os dados do cabeçalho e KPIs
        document.getElementById('project-name').textContent = project.name;
        document.getElementById('project-status').textContent = project.status;
        document.getElementById('project-professionals').textContent = project.professionals;
        document.getElementById('project-adoption').textContent = project.adoption + '%';
        document.getElementById('project-use-cases').textContent = project.useCases;
        document.getElementById('project-interactions').textContent = project.interactions.toLocaleString('pt-BR');
        
        // Atualiza o gráfico de evolução da adoção
        updateProjectAdoptionChart(project.adoptionTrend);
      }

      // Função para atualizar o gráfico de evolução da adoção
      function updateProjectAdoptionChart(adoptionData) {
        const months = ['Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro'];
        
        // Destrói o gráfico anterior se existir
        if (projectAdoptionChart) {
          projectAdoptionChart.destroy();
        }
        
          // Cria o novo gráfico
        projectAdoptionChart = new Chart(document.getElementById('projectAdoptionChart'), {
          type: 'line',
          data: {
            labels: months,
            datasets: [{
              label: 'Taxa de Adoção (%)',
              data: adoptionData,
              borderColor: 'rgba(123, 104, 238, 1)',
              backgroundColor: 'rgba(123, 104, 238, 0.2)',
              tension: 0.3,
              fill: true,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: '#ffffff',
              pointBorderColor: 'rgba(123, 104, 238, 1)',
              pointBorderWidth: 2,
              datalabels: {
                color: '#ffffff',
                anchor: 'end',
                align: 'top',
                offset: 5,
                formatter: value => value + '%',
                font: { weight: 'bold', size: 14 }
              }
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(30, 33, 48, 0.9)',
                titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 13 },
                padding: 12,
                displayColors: false,
                callbacks: {
                  label: context => `Taxa de Adoção: ${context.parsed.y}%`
                }
              }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: 'rgba(163, 168, 195, 0.8)' }
              },
              y: {
                beginAtZero: true,
                max: 100,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: 'rgba(163, 168, 195, 0.8)',
                  callback: value => value + '%'
                }
              }
            }
          }
        });
      }

      // Adiciona event listeners para as linhas da tabela
      document.querySelectorAll('#useCaseTable tbody tr').forEach(row => {
        row.addEventListener('click', () => {
          const useCaseId = row.getAttribute('data-id');
          updateUseCaseDetails(useCaseId);
        });
      });

      // ===== GRÁFICO: Interações por Mês (linha) =====
      (function renderInteractionsByMonth() {
        const labels = monthlyInteractions.map(item => item.month);
        const values = monthlyInteractions.map(item => item.interactions);
        const maxVal = Math.max(...values);
        const niceMax = Math.ceil((maxVal * 1.12) / 500) * 500;

        new Chart(document.getElementById('interactionsByMonth'), {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Interações Mensais',
              data: values,
              borderColor: 'rgba(123, 104, 238, 1)',
              backgroundColor: 'rgba(123, 104, 238, 0.2)',
              tension: 0.3,
              fill: true,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: '#ffffff',
              pointBorderColor: 'rgba(123, 104, 238, 1)',
              pointBorderWidth: 2,
              datalabels: {
                color: '#ffffff',
                anchor: 'end',
                align: 'top',
                offset: 5,
                formatter: v => Number(v || 0).toLocaleString('pt-BR'),
                font: { weight: 'bold', size: 14 }
              }
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(30, 33, 48, 0.9)',
                titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 13 },
                padding: 12,
                displayColors: false,
                callbacks: { 
                  label: ctx => `Interações: ${ctx.parsed.y.toLocaleString('pt-BR')}` 
                }
              }
            },
            scales: {
              x: { 
                grid: { display: false },
                ticks: { color: 'rgba(163, 168, 195, 0.8)' }
              },
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                max: niceMax,
                ticks: { 
                  color: 'rgba(163, 168, 195, 0.8)',
                  stepSize: 500 
                }
              }
            }
          }
        });
        resizeCanvases();
      })();

      // ===== GRÁFICO: Interações por Perfil (barras) =====
      function renderInteractionsByProfile(profileData) {
        const sorted = [...profileData].sort((a,b) => (b.interactions||0) - (a.interactions||0));
        const labels = sorted.map(item => item.profile);
        const values = sorted.map(item => item.interactions);

        const css = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
        const colors = [
          css('--piloto'),
          css('--wave1'),
          css('--wave2'),
          css('--wave3'),
          css('--wave4'),
          '#8888ff'
        ].slice(0, values.length);

        if (interactionsByProfileChart) interactionsByProfileChart.destroy();

        interactionsByProfileChart = new Chart(document.getElementById('interactionsByProfile'), {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Interações',
              data: values,
              backgroundColor: colors,
              borderColor: colors,
              borderWidth: 1,
              borderRadius: 6,
              categoryPercentage: 0.7,
              barPercentage: 0.65,
              maxBarThickness: 24,
              datalabels: {
                color: '#fff',
                anchor: 'end',
                align: 'end',
                offset: 3,
                formatter: v => Number(v || 0).toLocaleString('pt-BR'),
                font: { weight: 'bold', size: 14 }
              }
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: 'rgba(30, 33, 48, 0.9)',
                titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 13 },
                padding: 12,
                displayColors: false,
                callbacks: {
                  afterLabel: (tooltipItem) => {
                    const idx = tooltipItem.dataIndex;
                    const p = sorted[idx];
                    const total = values.reduce((a,b)=>a+b,0) || 1;
                    const percentage = ((p.interactions / total) * 100).toFixed(1);
                    return [
                      `Usuários: ${p.users ?? 0}`,
                      `Média por usuário: ${((p.users ?? 0) ? (p.interactions / p.users) : 0).toFixed(1)}`,
                      `Percentual: ${percentage}%`
                    ];
                  }
                }
              }
            },
            scales: {
              x: { 
                grid: { display: false },
                ticks: { color: 'rgba(163, 168, 195, 0.8)' }
              },
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                max: Math.ceil((Math.max(...values, 0) * 1.1) / 1000) * 1000 || undefined,
                ticks: { 
                  color: 'rgba(163, 168, 195, 0.8)',
                  stepSize: 1000 
                }
              }
            }
          }
        });

        resizeCanvases();
      }

      // =========================
      // Leitura da planilha (Ctrl+U) + normalização de colunas
      // =========================
      const KEY_USER_ALIASES    = ['nome do usuário','nome do usuario','usuario','usuário','user','nome'];
      const KEY_PROFILE_ALIASES = ['perfil','profile','cargo'];
      const KEY_PROJ_ALIASES    = ['projeto','project'];
      const KEY_WAVE_ALIASES    = ['implantação','implantacao','wave','onda'];
      const KEY_INTER_ALIASES   = ['interações','interacoes','interação','interacao','qtd interacoes','qtde interacoes','interactions'];

      function stripAccents(s) {
        return String(s || '').normalize('NFD').replace(/[\u0300-\u036f]/g, '');
      }
      function normKey(s) {
        return stripAccents(String(s || ''))
          .toLowerCase()
          .trim()
          .replace(/\s+/g, ' ')
          .replace(/[^\w ]+/g, ''); // remove pontuação
      }
      function buildKeyMapFromRow(row) {
        const map = new Map(); // normalized => actualKey
        Object.keys(row || {}).forEach(k => map.set(normKey(k), k));
        return map;
      }
      function getByAliases(row, keyMap, aliases) {
        for (const a of aliases) {
          const nk = normKey(a);
          const actual = keyMap.get(nk);
          if (actual && row[actual] !== undefined && row[actual] !== null && String(row[actual]).trim() !== '') {
            return row[actual];
          }
        }
        // fallback: tentativa por "contains"
        const keys = Array.from(keyMap.keys());
        for (const a of aliases) {
          const na = normKey(a);
          const found = keys.find(k => k.includes(na));
          if (found) {
            const actual = keyMap.get(found);
            if (actual && row[actual] !== undefined && row[actual] !== null && String(row[actual]).trim() !== '') {
              return row[actual];
            }
          }
        }
        return null;
      }
      function parseNumberBR(value) {
        if (value === null || value === undefined) return 0;
        if (typeof value === 'number') return Number.isFinite(value) ? value : 0;
        const s = String(value).trim();
        if (!s) return 0;

        // aceita "1.234", "1.234,56", "1234,56" etc.
        const cleaned = s
          .replace(/\u00A0/g, ' ')
          .replace(/\s/g, '')
          .replace(/\.(?=\d{3}(\D|$))/g, '') // remove . de milhar
          .replace(',', '.');

        const n = Number(cleaned);
        return Number.isFinite(n) ? n : 0;
      }

      function normalizePerfil(perfilRaw) {
        const p = stripAccents(perfilRaw || '').toLowerCase();
        if (p.includes('scrum')) return 'Scrum Master';
        if (p.includes('qa')) return 'QA';
        if (p.includes('sre')) return 'SRE';
        if (p.includes('dev')) return 'DEV';
        if (p.includes('analista de negocio') || p.includes('analista de negocios') || p.includes('negocio') || p.includes('negocios')) return 'Analista de Negócios';
        if (p.includes('analista de dados') || p.includes('dados') || p.includes('iam')) return 'Analista de Dados';
        return 'Outros';
      }

      function recalculateFromSheet(rows) {
        if (!Array.isArray(rows) || rows.length === 0) {
          return null;
        }

        const keyMap = buildKeyMapFromRow(rows[0]);

        const userMap = new Map();
        const projetosSet = new Set();

        for (const row of rows) {
          const user = getByAliases(row, keyMap, KEY_USER_ALIASES);
          if (!user) continue;

          const perfilRaw = getByAliases(row, keyMap, KEY_PROFILE_ALIASES) || '';
          const proj      = getByAliases(row, keyMap, KEY_PROJ_ALIASES);
          const wave      = getByAliases(row, keyMap, KEY_WAVE_ALIASES) || '';
          const interRaw  = getByAliases(row, keyMap, KEY_INTER_ALIASES);
          const inter     = parseNumberBR(interRaw);

          const userId = String(user).trim();

          let u = userMap.get(userId);
          if (!u) {
            u = {
              nome: userId,
              perfilRaw: perfilRaw || '',
              wave: wave || '',
              interactions: 0,
              projetos: new Set()
            };
            userMap.set(userId, u);
          }
          u.interactions += inter;

          if (proj) {
            const projId = String(proj).trim();
            if (projId) {
              u.projetos.add(projId);
              projetosSet.add(projId);
            }
          }
        }

        const totalProf = userMap.size;
        let totalInteracoes = 0;
        let ativos = 0;

        const perfilAgg = new Map(); // label => { interactions, users:Set }

        for (const [,u] of userMap) {
          totalInteracoes += u.interactions;
          if (u.interactions > 0) ativos++;

          const label = normalizePerfil(u.perfilRaw);
          if (!perfilAgg.has(label)) perfilAgg.set(label, { interactions: 0, users: new Set() });

          const agg = perfilAgg.get(label);
          agg.interactions += u.interactions;
          agg.users.add(u.nome);
        }

        const semInteracao = totalProf - ativos;
        const adocaoPctCalc = totalProf ? (ativos / totalProf * 100) : 0;
        const mediaAtivo = ativos ? (totalInteracoes / ativos) : 0;

        const profileArray = [];
        ['QA','Scrum Master','SRE','DEV','Analista de Negócios','Analista de Dados'].forEach(label => {
          const agg = perfilAgg.get(label);
          if (agg) {
            profileArray.push({
              profile: label,
              interactions: agg.interactions,
              users: agg.users.size
            });
          }
        });

        // inclui Outros (se existir)
        const outros = perfilAgg.get('Outros');
        if (outros && outros.users.size) {
          profileArray.push({ profile: 'Outros', interactions: outros.interactions, users: outros.users.size });
        }

        return {
          profissionais: totalProf,
          ativos,
          semInteracao,
          projetos: projetosSet.size,
           adocaoPct: adocaoPctCalc,
          totalInteracoes,
          mediaAtivo,
          profiles: profileArray
        };
      }

      function applyMetricsToDashboard(m) {
        if (!m || !m.profissionais) return;

        document.getElementById('k_proj_total').textContent = (m.projetos ?? 0).toLocaleString('pt-BR');
        document.getElementById('k_total').textContent = (m.profissionais ?? 0).toLocaleString('pt-BR');
        document.getElementById('k_ativos').textContent = (m.ativos ?? 0).toLocaleString('pt-BR');

        document.getElementById('k_adocao').textContent =
          (m.adocaoPct ?? 0).toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';

        document.getElementById('k_sem').textContent = (m.semInteracao ?? 0).toLocaleString('pt-BR');
        const semPct = m.profissionais ? ((m.semInteracao / m.profissionais) * 100) : 0;
         document.getElementById('k_sem_pct').textContent =
          semPct.toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';

        document.getElementById('k_taxa_v').textContent =
          (m.adocaoPct ?? 0).toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';

        document.getElementById('k_taxa_desc').textContent =
          `${(m.ativos ?? 0).toLocaleString('pt-BR')} de ${(m.profissionais ?? 0).toLocaleString('pt-BR')} usuários ativos`;

        document.getElementById('k_inter').textContent =
          (m.totalInteracoes ?? 0).toLocaleString('pt-BR');

        document.getElementById('k_media_global').textContent =
          `Média: ${(m.mediaAtivo ?? 0).toLocaleString('pt-BR', { maximumFractionDigits: 1 })} por usuário ativo`;

        // Atualiza cards + gráfico
        renderProfilesCards(m.profiles || []);
        renderInteractionsByProfile(m.profiles || []);

        // Persistir
        saveMetricsToStorage(m);

        // Aplicar SEMPRE os fixos manuais (não deixa a planilha sobrescrever)
        applyFixedAdoptionRates();

        console.log('[GenAI Dashboard] KPIs aplicados e métricas persistidas no localStorage.');
      }

      function handleSheetFile(file) {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });

            // Sugestão: tentar achar a primeira aba com conteúdo
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            const rows = XLSX.utils.sheet_to_json(sheet, { defval: null });

            const metrics = recalculateFromSheet(rows);
            if (!metrics || !metrics.profissionais) {
              alert('Não foi possível extrair métricas. Verifique se a planilha tem cabeçalhos e linhas preenchidas.');
              return;
            }
            applyMetricsToDashboard(metrics);
          } catch (err) {
            console.error('Erro ao processar a planilha:', err);
            alert('Não foi possível ler a planilha. Verifique o formato e os cabeçalhos das colunas.');
          }
        };
        reader.readAsArrayBuffer(file);
      }

      // Ctrl+U -> abrir seletor
      const hiddenInput = document.getElementById('hiddenSheetInput');
      hiddenInput.addEventListener('change', (e) => {
        const file = e.target.files && e.target.files[0];
        if (file) handleSheetFile(file);
        e.target.value = '';
      });
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key.toLowerCase() === 'u') {
          e.preventDefault();
          hiddenInput.click();
        }
      });

      // =========================
      // Estado inicial (fallback) ou persistido
      // =========================
      const persistedMetrics = loadMetricsFromStorage();

      if (persistedMetrics) {
        applyMetricsToDashboard(persistedMetrics);
      } else {
        // Fallback (iniciais)
        const totals = { projetos: 49, profissionais: 351, ativos: 310, semInteracao: 41, totalInteracoes: 13464 };
        const adocaoPct = totals.profissionais ? (totals.ativos / totals.profissionais) * 100 : 0;
        const mediaGlobal = totals.ativos ? (totals.totalInteracoes / totals.ativos) : 0;

        document.getElementById('k_proj_total').textContent = totals.projetos;
        document.getElementById('k_total').textContent = totals.profissionais;
        document.getElementById('k_ativos').textContent = totals.ativos;
        document.getElementById('k_adocao').textContent = adocaoPct.toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';
        document.getElementById('k_sem').textContent = totals.semInteracao;
        document.getElementById('k_sem_pct').textContent =
          ((totals.semInteracao / totals.profissionais) * 100).toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';
        document.getElementById('k_taxa_v').textContent = adocaoPct.toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + '%';
        document.getElementById('k_taxa_desc').textContent = `${totals.ativos} de ${totals.profissionais} usuários ativos`;
        document.getElementById('k_inter').textContent = totals.totalInteracoes.toLocaleString('pt-BR');
        document.getElementById('k_media_global').textContent =
          `Média: ${mediaGlobal.toLocaleString('pt-BR', { maximumFractionDigits: 1 })} por usuário ativo`;

        renderProfilesCards(profileInteractionsInitial);
        renderInteractionsByProfile(profileInteractionsInitial);

        // Aplica fixos manuais também no fallback
        applyFixedAdoptionRates();
      }

      // Inicializa o detalhe do caso de uso com o primeiro item selecionado
      updateUseCaseDetails('code-review');
      
      // Inicializa a visão por projeto com todos os projetos
      const projectFilter = document.getElementById('project-filter');
      if (projectFilter) {
        projectFilter.addEventListener('change', function() {
          updateProjectView(this.value);
        });
        
        // Inicializa com o valor padrão (todos os projetos)
        updateProjectView('all');
      }
    });
  </script>
</body>
</html>
    
  </body>
  
</html>
